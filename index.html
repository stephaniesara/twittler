<!DOCTYPE html>
<html lang="en">
<html>

<head>
  <meta charset="utf-8">
  <title>Twittler</title>
  <link rel="stylesheet" href="assets/stylesheets/main.css">
  <script src="jquery.js"></script>
  <script src="data_generator.js"></script>
</head>

<body>

  <header>
    <h1>Twittler</h1>
  </header>

  <button type="button">Click to see your Twittler feed...</button>
  <div></div>

  <script>

  // To keep track of how many new tweets the user can see in the feed
  var prevTweets = streams.home.length - 1;
  var currTweets = prevTweets;

  // To keep track of whether the user has initiated the feed by clicking the view button
  var initiated = false;

  $(document).ready(function(){
    $( "button" ).on('click', function( event ) {

      // Sets up the feed button to auto-refresh every 5 sec for new tweets
      if (!initiated) {
        initiated = true;
        setInterval(function() {
          currTweets = streams.home.length;
          var diff = currTweets - prevTweets;
          $("button").text("Click to refresh your feed (" + diff + ')');
        }, 5000);
      }

      // Resets the number of total tweets in feed
      prevTweets = currTweets;

      // Updates the view button to display that feed is up to date
      $("button").text("Your feed is up to date");

      // Displays all the tweets in the feed
      var $div = $('div');
      $div.html('');
      var index = streams.home.length - 1;
      while(index >= 0){
        var tweet = streams.home[index];

        var username = tweet.user;
        var message = tweet.message;
        var timestamp = tweet.created_at;
        var minutesAgo = Math.floor((new Date() - timestamp) / 1000 / 60);

        $('div').append("<h3>" + '@' + username + "</h3>");
        $('div').append("<h5>" + message + '</h5>');
        $('div').append("<p>" + minutesAgo + " min ago - " + timestamp + '<br />' + '<br />' + "</p>");

        index -= 1;
      }
    });
  });

  </script>
</body>
</html>
